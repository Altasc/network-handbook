# 【计算机网络——从入门到入土】1.2性能
## 为什么游戏上面会显示延迟？
凌晨12点，夜深人静，刚刚结束二重积分的MC躺在床上，准备睡觉。睡神悄然降临在MC的脑后，MC的双眼终于耗尽了最后一丝力气，慢慢的闭上了。在朦胧中，MC仿佛听见了什么东西正在召唤他，貌似什么东西忘记处理了。突然，MC睁开了眼，天塌了！手游的每日任务没有打！
这真是一个非常头疼的事情，MC不想再开电脑了，于是他熟练地拿起了床边的手机，打开了云游戏，开始了每日任务的清理。然而，这一切并不顺利，路由器深夜好像也需要休息，于是网络延迟直线上升。MC在抱怨的同时，望着游戏画面上面的几个网络指标，开始思考：网络的延迟是怎么计算的？还有没有其他的指标来描述网络的性能？延迟后面的带宽和丢包率又是什么？他自己没法解决这些问题，于是找到了你，并想你求助。
## 网络性能
怎么描述一个网络的性能呢？人有身高、体重、BMI等等数据来描述这具身体的情况，同样的在计算机网络中就有前面云游戏中我们看到的时延、带宽，除此之外还有吞吐量、时延带宽积和信道利用率这些常见的描述网络性能的指标。
### 时延
无论是CS还是鸣潮，这类联机游戏往往都能在角落看到时延，说明时延是非常重要的网络指标。
我们在生活中做任何事情都需要时间，同样的，在分组传输中，也会有时间的消耗。
现在，有一个幸运的分组被我们注意到了，这个分组传输的时候将会在哪里消耗时间呢？首先是**处理时延**，这里面包括了各种各样的杂乱的事情，检查分组首部、决定将这个分组导向何处以及分组是否存在错误等等所消耗的时间全部被计入了处理时延中。当刚刚的问题全部都落实之后，这已经是一个合格的分组了，于是这个分组放在传输队列中排队等待传输，这里消耗的时间称为**排队时延**。在等待许久之后（也可能没有等待，因为有时候队列中根本没有分组排队），前面的分组终于被推向链路了，轮到我们这个幸运的分组了。我们假设分组长度为L（比如1000B），链路传输速率为R（10Mb/s），那么**传输时延**（有地方也把这个称为**发送时延**）就是L/R（0.8ms），也就是说这个分组的所有比特需要L/R秒才能全部推向链路。特别注意，有个时延名字和传输时延很像，叫做**传播时延**，它和传输时延有什么区别呢？我们继续分析，此时我们的分组已经变成电信号沿着电缆（也可能是光信号沿着光纤）传输了，众所周知，电信号是有传输速度的，电缆是有长度的，那么这里注定将会消耗一部分时间用于传输，这个时间就称为传播时延。
节点总时延就由上面的四种重要的时延组成，其他的时延影响不大，即节点总时延=处理时延+排队时延+发送时延+传播时延。
### 带宽
让我们看到云游戏中的另外一个描述网络的指标——**带宽**。带宽其实非常好理解，与电子通信不同，计算机网络中带宽指的是网络的通信链路传输数据的能力，我们在解释传输时延的时候，用到了“链路传输速率”这样的一个名词，带宽就是最高链路传输速率。
### 丢包率
游戏中还有一个指标，丢包率，顾名思义，就是丢弃的数据包占所有数据包的比例嘛。为什么会发生丢包呢？在刚刚时延的讨论中，我们提到了分组在被传输前需要在传输队列中等待。我们设分组到达队列的平均速率为a，分组的长度和链路传输速率仍然为L和R。动动脑子，我们发现，如果a*L超过了R，那么分组就会在传输队列中开始堆积，队列会变得越来越长。队列是不可能无限大的，如果在某一时刻，队列满了，而正好到来了一个新的分组，很遗憾，这个分组只能被丢弃，此时**丢包**就发生了。丢包只会发生在传输队列中吗？未必。我们的物理世界是非常复杂的，分组在传输的时候可能会出现损坏，这些损坏且没法修复的的分组也只能丢弃。
### 吞吐量
各位在使用下载器（浏览器也行）在下载的文件的时候，往往进度条的旁边会显示一个速率，这个速率我们就称为**瞬时吞吐量**，也就是单位时间内通过某个网络（或者信道、接口）的实际数据量。如果这个文件有f比特，接收这个文件花费了t秒，那么我们称f/t为文件传输的**平均吞吐量**。
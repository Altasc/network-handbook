# 【计算机网络——从入门到入土】1.3分层结构
## 传输的典范：快递寄送
从快递的视角来理解计算机网络的分层结构再合适不过了。下午2点，暑气腾腾，ZZY在空调房中享受着美好的午睡时光，等着快递小哥上门取件。“这么热的天，他应该不会那么早到吧。”他心里想着。不幸的是，我们的快递小哥是那么的敬业，5s之后便敲响了ZZY的房门。现在是快递小哥等待ZZY了，他只能快速地结束午后美梦，然后迅速起床将快件交给快递小哥。为什么快递小哥永远都那么高效？为什么快递（当然前提是靠谱的快递公司）总是能准时地将快件送到收件人手中？我们带着这些疑问来好好分析。
### 快递从发件到收件经过了哪些过程？
我们从被寄出的物品的视角，来仔细梳理整个收寄件过程。在叫快递小哥之前，我们需要先仔仔细细地确定好自己准备寄出的物品，随后进行包装（避免被暴力快递搞坏）。确定包装妥当之后，我们就叫快递小哥来取件。他会哼着歌开着电动车到楼下，上楼确认需要寄出的物品，贴上标签，然后将快件放在电动车后面的箱子里。接下来我们就要拿出手机来获取快递运送的进度了，可以看到，我们的快递先是到了这个社区的配送营业点，随后到了整个地区的分拣中心，在漫长的等待之后，它到了另一个地区的分拣中心，再从这个地区的分拣中心出发，到下属的配送营业点，最后又是由快递小哥送到收件人的手中。
### 每个过程到底在做什么？
我们再来好好看看每个环节在做什么。寄件人只需要将物品包装好，随后移交给快递小哥就可以了。快递小哥只需要从不同的寄件人手中收取快件，将快件放入到电动车后面的快递箱，随后移交到配送营业点就可以了。配送营业点只需要接收快递小哥送来的快件，然后将各种各样的快件尽可能多的装上开往分拣中心的小货车，跟货车司机挥手说拜拜，它的任务也完成了。分拣中心收到了来自各个配送营业点的快件后，就开始给快件按照其目的地所属的分拣中心分类，随后将分好类的快件装入大卡车发车即可。等大卡车到了它的目的地之后，另一个地区的分拣中心开始给快件按照快件目的地所属的配送营业点分类，然后发往配送营业点。配送营业点接收来自分拣中心的快件，再分类，然后交给对应街道的快递小哥。最后快递小哥从配送营业点接收快件，挨家挨户地送货上门，我们的快件终于到了收件人的手中了！
## 协议
在进一步讨论因特网之前，我们先了解一下什么是协议。在因特网中，我们总是能听见“HTTP协议”、“TCP协议”还有“IP协议”这种各种各样的协议。我们大多数时候只知道XX协议是用来干什么的，很少听说过一个对协议这个词的准确定义。为了方便理解，我们干脆给协议是干什么的做一个规定：**协议**定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文的发送、接收或其他时间所采取的操作。
## 协议分层
运送一件快递到一个地方是非常简单的，但如果是运送一百件快递到一百个地方，一万件快递到一万个地方呢？必须承认，这真的是一件相当困难的事情，而我们的快递公司却能够出色的解决。快件运输是一个非常复杂的系统，在这么多快件需要运输的情况下，它仍然能够高效的运行并以令人吃惊的速度送达到收件人的手中，这完全得益于快递公司在物品运输的每个阶段清晰地规定了需要完成的工作。回顾刚刚物品的视角和各个环节的视角，我们发现，虽然运输快件这个整体的工作是非常复杂且抽象的，但是其中每个环节的工作却是非常简单且具体的。让我们回到因特网。面对浩如烟海的数据等待着传输，因特网的压力和快递公司一样巨大。巧合的是，因特网也和快递公司一样，将整个过程分成了不同的层次，把每层需要做的事情用协议一一规定到位，各个层只需要在前一个层次的基础之上完成所使用的协议的要求，随后交给下一层即可。各层的所有协议我们称为**协议栈**。
### 一般来说
一般来说，因特网的协议栈被分成了五个层次，自上而下分别是应用层、运输层、网络层、链路层和物理层。
#### 应用层
应用层是网络应用程序及他们的应用层协议留存的地方，比如说我们上网冲浪使用的HTTP协议、发送电子邮件使用的SMTP协议以及文件传输时使用的FTP协议就属于这一层。当一台主机上的应用程序需要向另一台主机上的应用程序发送数据时，发送端就按照约定好的应用层协议组装好分组，随后发送给另一台主机，另一台主机也按照约定好的应用层协议解析分组，提取需要的数据。位于应用层的分组我们将它称为**报文**。
#### 运输层
运输层在应用程序端点之间传输应用层报文，这里有两种协议，分别是TCP和UDP。位于运输层的分组我们将它称为**报文段**。
#### 网络层
网络层负责将**数据报**的网络层分组从一台主机移动到另一台主机。我们口中左一句又一句的IP就出自这里——网际协议，除此之外，还有用来决定路由的路由选择协议。
#### 链路层
通过链路层的服务，我们能够将分组从主机或路由器（统称为节点）传递到下一个节点。位于链路层的分组我们称它为**帧**。
#### 物理层
物理层的任务是物理意义上的把来自链路层的帧一个一个比特地从一个节点移动到下一个节点，它可以理解为链路层的拓展，但是更加偏向于硬件，也就是这一层的协议与之前提到的双绞铜线、同轴电缆等等这些物理媒介紧紧相连。
<!-- ### TCP/IP
前面我们已经把层次的划分和每个层次执行的协议给出一个相当明确的定义，但是考虑到要应付考试，所以再加两个不同的层次分法，简要地做一个说明。首先是TCP/IP模型，TCP/IP模型将协议栈分成了四个层次，其因为广泛的使用而成为事实上的国际标准，这四个层次自上而下分别是应用层、传输层、网际层和网络接口层。
#### 应用层
对应的就是我们前面五个层次中的应用层。
#### 传输层
对应的就是我们前面五个层次中的传输层。
#### 网际层

#### 网络接口层

### OSI
当然，因特网作为国际上通用的网络，ISO（国际标准化组织）自然而然地也想来插一手。于是它们也提出了一种划分方法，将协议栈分成了七个层次，称为开放系统互连模型（也就是OSI）。这七个层次自上而下分别是应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。
#### 应用层
对应的就是我们前面五个层次中的应用层。
#### 表示层
不同的主机采用的编码和表示方式各不相同，于是就有了表示层来处理不同主机中交换信息的表示方式。
#### 会话层

#### 传输层

#### 网络层

#### 数据链路层

#### 物理层
 -->
### 封装
一般来说，每层分组有两个类型的字段，分别是**首部字段**和**有效载荷字段**。首部字段即为该层处理来自上一层的分组时添加的附加信息，就像寄快递时小哥会在包装上面贴一张记录着收件人的贴纸；而有效载荷字段往往就是上一层传来的分组。